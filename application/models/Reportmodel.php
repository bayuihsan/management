<?php

class ReportModel extends CI_Model{

// db2 digunakan untuk mengakses database ke-2
	private $db2;

	public function __construct()
	{
		parent::__construct();
	    $this->db2 = $this->load->database('hvc',TRUE); 
	}

	public function getMaxDate(){
		//get Max Date
		$sess_level = $this->session->userdata('level');
		$sess_branch = $this->session->userdata('branch_id');
		if($this->session->userdata('level')==4){
			$max_query=$this->db->query("SELECT max(DATE_FORMAT(tanggal_masuk,'%Y-%m-%d')) as tgl_max FROM new_psb");
		}else{
			$max_query=$this->db->query("SELECT max(DATE_FORMAT(tanggal_masuk,'%Y-%m-%d')) as tgl_max FROM new_psb where branch_id='".$sess_branch."'");
		}
			
		$max_result = $max_query->row();

		return $max_result;
	}

	public function get_tanggal(){
		$q_tanggal = $this->db->query("select * from t_tanggal")->result();
		return $q_tanggal;
	}

	public function getCurMont($tgl=""){
		//Get Current Day PSB, Expense AND Current Month PSB
		date_default_timezone_set(get_current_setting('timezone'));	
		$date=$tgl;	
		// $date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		//Current Day PSB
		$current_query=$this->db->query("SELECT count(a.psb_id) as amount, sum(b.harga_paket) as revenue  
			FROM new_psb a
			JOIN paket b ON a.paket_id=b.paket_id
			WHERE a.status='sukses' AND DATE_FORMAT(a.tanggal_aktif,'%Y-%m-%d')='".$date."'");	
		$current_result=$current_query->row();

		//Current Month PSB
		$curmonth_query=$this->db->query("SELECT count(a.psb_id) as amount, sum(b.harga_paket) as revenue 
			FROM new_psb a 
			JOIN paket b ON a.paket_id=b.paket_id
			WHERE a.status='sukses' AND DATE_FORMAT(a.tanggal_aktif,'%Y-%m-%d') between ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'");	
		$curmonth_result=$curmonth_query->row();

		$transaction=array(
			"current_day_psb"=>isset($current_result->amount) ? number_format($current_result->amount) : number_format(0),
			"current_day_revenue"=> isset($current_result->revenue) ? number_format($current_result->revenue) : number_format(0),
			"current_month_psb"=> isset($curmonth_result->amount) ? number_format($curmonth_result->amount) : number_format(0),
			"current_month_revenue"=> isset($curmonth_result->revenue) ? number_format($curmonth_result->revenue) : number_format(0),

		);	

		return $transaction;
	}

	public function getSumCM($tgl=""){
		//Get Current Day PSB, Expense AND Current Month PSB
		date_default_timezone_set(get_current_setting('timezone'));	
		$date=$tgl;	
		// $date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		//sales
		$sales_query=$this->db2->query("SELECT count(*) amount
		FROM
		  V_CM_NEWACTIVATION_2018 
		WHERE TYPE IN ('R','S') AND DATE_FORMAT(activation_date,'%Y-%m-%d') between ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'
		  AND SUBSTR(msisdn,1,8) IN (
		62811100,62811101,62811102,62811103,62811104,62811105,62811106,62811107,62811108,62811109,62811110,62811111,62811112,62811113,62811114,62811115,62811116,62811117,62811118,62811119,62811120,62811121,62811122,62811123,62811124,62811125,62811126,62811127,62811128,62811129,62811130,62811131,62811132,62811133,62811134,62811135,62811136,62811137,62811138,62811139,62811140,62811141,62811142,62811143,62811144,62811145,62811146,62811147,62811148,62811149,62811150,62811151,62811152,62811153,62811154,62811155,62811156,62811157,62811158,62811159,62811160,62811161,62811162,62811163,62811164,62811165,62811166,62811167,62811168,62811169,62811170,62811171,62811172,62811173,62811174,62811175,62811176,62811177,62811178,62811179,62811180,62811181,62811182,62811183,62811184,62811185,62811186,62811187,62811188,62811189,62811190,62811191,62811192,62811193,62811194,62811195,62811196,62811197,62811198,62811199,62811200,62811201,62811202,62811203,62811204,62811205,62811206,62811207,62811208,62811209,62811210,62811211,62811212,62811213,62811214,62811215,62811216,62811217,62811218,62811219,62811220,62811221,62811222,62811223,62811224,62811225,62811226,62811227,62811228,62811229,62811230,62811231,62811232,62811233,62811234,62811235,62811236,62811237,62811238,62811239,62811240,62811241,62811242,62811243,62811244,62811245,62811246,62811247,62811248,62811249,62811800,62811801,62811802,62811803,62811804,62811805,62811806,62811807,62811808,62811809,62811810,62811811,62811812,62811813,62811814,62811815,62811816,62811817,62811818,62811819,62811820,62811821,62811822,62811823,62811824,62811825,62811826,62811827,62811828,62811829,62811830,62811831,62811832,62811833,62811834,62811835,62811836,62811837,62811838,62811839,62811840,62811841,62811842,62811843,62811844,62811845,62811846,62811847,62811848,62811849,62811850,62811851,62811852,62811853,62811854,62811855,62811856,62811857,62811858,62811859,62811860,62811861,62811862,62811863,62811864,62811865,62811866,62811867,62811868,62811869,62811870,62811871,62811872,62811873,62811874,62811875,62811876,62811877,62811878,62811879,62811880,62811881,62811882,62811883,62811884,62811885,62811886,62811887,62811888,62811889,62811890,62811891,62811892,62811893,62811894,62811895,62811896,62811897,62811898,62811899,62811900,62811901,62811902,62811903,62811904,62811905,62811906,62811907,62811908,62811909,62811910,62811911,62811912,62811913,62811914,62811915,62811916,62811917,62811918,62811919,62811920,62811921,62811922,62811923,62811924,62811925,62811926,62811927,62811928,62811929,62811930,62811931,62811932,62811933,62811934,62811935,62811936,62811937,62811938,62811939,62811940,62811941,62811942,62811943,62811944,62811945,62811946,62811947,62811948,62811949,62811950,62811951,62811952,62811953,62811954,62811955,62811956,62811957,62811958,62811959,62811960,62811961,62811962,62811963,62811964,62811965,62811966,62811967,62811968,62811969,62811970,62811971,62811972,62811973,62811974,62811975,62811976,62811977,62811978,62811979,62811980,62811981,62811982,62811983,62811984,62811985,62811986,62811987,62811988,62811989,62811990,62811991,62811992,62811993,62811994,62811995,62811996,62811997,62811998,62811999,62812100,62812101,62812102,62812103,62812104,62812105,62812106,62812107,62812108,62812109,62812110,62812111,62812112,62812113,62812114,62812115,62812116,62812117,62812118,62812119,62812120,62812121,62812122,62812123,62812124,62812125,62812126,62812127,62812128,62812129,62812130,62812131,62812132,62812133,62812134,62812135,62812136,62812137,62812138,62812139,62812140,62812141,62812142,62812143,62812144,62812145,62812146,62812147,62812148,62812149,62812180,62812181,62812182,62812183,62812184,62812185,62812186,62812187,62812188,62812189,62812190,62812191,62812192,62812193,62812194,62812195,62812196,62812197,62812198,62812199,62812200,62812201,62812202,62812203,62812204,62812205,62812206,62812207,62812208,62812209,62812210,62812211,62812212,62812213,62812214,62812215,62812216,62812217,62812218,62812219,62812220,62812221,62812222,62812223,62812224,62812225,62812226,62812227,62812228,62812229,62812230,62812231,62812232,62812233,62812234,62812235,62812236,62812237,62812238,62812239,62812240,62812241,62812242,62812243,62812244,62812245,62812246,62812247,62812248,62812249,62812800,62812801,62812802,62812803,62812804,62812805,62812806,62812807,62812808,62812809,62812810,62812811,62812812,62812813,62812814,62812815,62812816,62812817,62812818,62812819,62812820,62812821,62812822,62812823,62812824,62812825,62812826,62812827,62812828,62812829,62812830,62812831,62812832,62812833,62812834,62812835,62812836,62812837,62812838,62812839,62812840,62812841,62812842,62812843,62812844,62812845,62812846,62812847,62812848,62812849,62812850,62812851,62812852,62812853,62812854,62812855,62812856,62812857,62812858,62812859,62812860,62812861,62812862,62812863,62812864,62812865,62812866,62812867,62812868,62812869,62812870,62812871,62812872,62812873,62812874,62812875,62812876,62812877,62812878,62812879,62812880,62812881,62812882,62812883,62812884,62812885,62812886,62812887,62812888,62812889,62812890,62812891,62812892,62812893,62812894,62812895,62812896,62812897,62812898,62812899,62812900,62812901,62812902,62812903,62812904,62812905,62812906,62812907,62812908,62812909,62812910,62812911,62812912,62812913,62812914,62812915,62812916,62812917,62812918,62812919,62812920,62812921,62812922,62812923,62812924,62812925,62812926,62812927,62812928,62812929,62812930,62812931,62812932,62812933,62812934,62812935,62812936,62812937,62812938,62812939,62812940,62812941,62812942,62812943,62812944,62812945,62812946,62812947,62812948,62812949,62812950,62812951,62812952,62812953,62812954,62812955,62812956,62812957,62812958,62812959,62812960,62812961,62812962,62812963,62812964,62812965,62812966,62812967,62812968,62812969,62812970,62812971,62812972,62812973,62812974,62812975,62812976,62812977,62812978,62812979,62812980,62812981,62812982,62812983,62812984,62812985,62812986,62812987,62812988,62812989,62812990,62812991,62812992,62812993,62812994,62812995,62812996,62812997,62812998,62812999,62813100,62813101,62813102,62813103,62813104,62813105,62813106,62813107,62813108,62813109,62813110,62813111,62813112,62813113,62813114,62813115,62813116,62813117,62813118,62813119,62813120,62813121,62813122,62813123,62813124,62813125,62813126,62813127,62813128,62813129,62813130,62813131,62813132,62813133,62813134,62813135,62813136,62813137,62813138,62813139,62813140,62813141,62813142,62813143,62813144,62813145,62813146,62813147,62813148,62813149,62813150,62813151,62813152,62813153,62813154,62813155,62813156,62813157,62813158,62813159,62813160,62813161,62813162,62813163,62813164,62813165,62813166,62813167,62813168,62813169,62813170,62813171,62813172,62813173,62813174,62813175,62813176,62813177,62813178,62813179,62813180,62813181,62813182,62813183,62813184,62813185,62813186,62813187,62813188,62813189,62813190,62813191,62813192,62813193,62813194,62813195,62813196,62813197,62813198,62813199,62813200,62813201,62813202,62813203,62813204,62813205,62813206,62813207,62813208,62813209,62813210,62813211,62813212,62813213,62813214,62813215,62813216,62813217,62813218,62813219,62813220,62813221,62813222,62813223,62813224,62813225,62813226,62813227,62813228,62813229,62813230,62813231,62813232,62813233,62813234,62813235,62813236,62813237,62813238,62813239,62813240,62813241,62813242,62813243,62813244,62813245,62813246,62813247,62813248,62813249,62813800,62813801,62813802,62813803,62813804,62813805,62813806,62813807,62813808,62813809,62813810,62813811,62813812,62813813,62813814,62813815,62813816,62813817,62813818,62813819,62813820,62813821,62813822,62813823,62813824,62813825,62813826,62813827,62813828,62813829,62813830,62813831,62813832,62813833,62813834,62813835,62813836,62813837,62813838,62813839,62813840,62813841,62813842,62813843,62813844,62813845,62813846,62813847,62813848,62813849,62813850,62813851,62813852,62813853,62813854,62813855,62813856,62813857,62813858,62813859,62813860,62813861,62813862,62813863,62813864,62813865,62813866,62813867,62813868,62813869,62813870,62813871,62813872,62813873,62813874,62813875,62813876,62813877,62813878,62813879,62813880,62813881,62813882,62813883,62813884,62813885,62813886,62813887,62813888,62813889,62813890,62813891,62813892,62813893,62813894,62813895,62813896,62813897,62813898,62813899,62813940,62813941,62813942,62813943,62813944,62813945,62813946,62813947,62813948,62813949,62813950,62813951,62813952,62813953,62813954,62813955,62813956,62813957,62813958,62813959,62813980,62813981,62813982,62813983,62813984,62813985,62813986,62813987,62813988,62813989,62813990,62813991,62813992,62813993,62813994,62813995,62813996,62813997,62813998,62813999,62821100,62821101,62821102,62821103,62821104,62821105,62821106,62821107,62821108,62821109,62821110,62821111,62821112,62821113,62821114,62821115,62821116,62821117,62821118,62821119,62821120,62821121,62821122,62821123,62821124,62821125,62821126,62821127,62821128,62821129,62821130,62821131,62821132,62821133,62821134,62821135,62821136,62821137,62821138,62821139,62821140,62821141,62821142,62821143,62821144,62821145,62821146,62821147,62821148,62821149,62821150,62821151,62821152,62821153,62821154,62821155,62821156,62821157,62821158,62821159,62821160,62821161,62821162,62821163,62821164,62821165,62821166,62821167,62821168,62821169,62821170,62821171,62821172,62821173,62821174,62821175,62821176,62821177,62821178,62821179,62821180,62821181,62821182,62821183,62821184,62821185,62821186,62821187,62821188,62821189,62821190,62821191,62821192,62821193,62821194,62821195,62821196,62821197,62821198,62821199,62821200,62821201,62821202,62821203,62821204,62821205,62821206,62821207,62821208,62821209,62821210,62821211,62821212,62821213,62821214,62821215,62821216,62821217,62821218,62821219,62821220,62821221,62821222,62821223,62821224,62821225,62821226,62821227,62821228,62821229,62821230,62821231,62821232,62821233,62821234,62821235,62821236,62821237,62821238,62821239,62821240,62821241,62821242,62821243,62821244,62821245,62821246,62821247,62821248,62821249,62821250,62821251,62821252,62821253,62821254,62821255,62821256,62821257,62821258,62821259,62821260,62821261,62821262,62821263,62821264,62821265,62821266,62821267,62821268,62821269,62821270,62821271,62821272,62821273,62821274,62821275,62821276,62821277,62821278,62821279,62821280,62821281,62821282,62821283,62821284,62821285,62821286,62821287,62821288,62821289,62821290,62821291,62821292,62821293,62821294,62821295,62821296,62821297,62821298,62821299,62821300,62821301,62821302,62821303,62821304,62821305,62821306,62821307,62821308,62821309,62822080,62822081,62822082,62822083,62822084,62822085,62822086,62822087,62822088,62822089,62822100,62822101,62822102,62822103,62822104,62822105,62822106,62822107,62822108,62822109,62822110,62822111,62822112,62822113,62822114,62822115,62822116,62822117,62822118,62822119,62822120,62822121,62822122,62822123,62822124,62822125,62822126,62822127,62822128,62822129,62822130,62822131,62822132,62822133,62822134,62822135,62822136,62822137,62822138,62822139,62822140,62822141,62822142,62822143,62822144,62822145,62822146,62822147,62822148,62822149,62822150,62822151,62822152,62822153,62822154,62822155,62822156,62822157,62822158,62822159,62822160,62822161,62822162,62822163,62822164,62822165,62822166,62822167,62822168,62822169,62822170,62822171,62822172,62822173,62822174,62822175,62822176,62822177,62822178,62822179,62822180,62822181,62822182,62822183,62822184,62822185,62822186,62822187,62822188,62822189,62822190,62822191,62822192,62822193,62822194,62822195,62822196,62822197,62822198,62822199,62822400,62822401,62822402,62822403,62822404,62822405,62822406,62822407,62822408,62822409,62822600,62822601,62822602,62822603,62822604,62822605,62822606,62822607,62822608,62822609,62822610,62822611,62822612,62822613,62822614,62822615,62822616,62822617,62822618,62822619,62822620,62822621,62822622,62822623,62822624,62822625,62822626,62822627,62822628,62822629,62822630,62822631,62822632,62822633,62822634,62822635,62822636,62822637,62822638,62822639,62822950,62822951,62822952,62822953,62822954,62822955,62822956,62822957,62822958,62822959,62822970,62822971,62822972,62822973,62822974,62822975,62822976,62822977,62822978,62822979,62822980,62822981,62822982,62822983,62822984,62822985,62822986,62822987,62822988,62822989,62822990,62822991,62822992,62822993,62822994,62822995,62822996,62822997,62822998,62822999,62823100,62823101,62823102,62823103,62823104,62823105,62823106,62823107,62823108,62823109,62823110,62823111,62823112,62823113,62823114,62823115,62823116,62823117,62823118,62823119,62823120,62823121,62823122,62823123,62823124,62823125,62823126,62823127,62823128,62823129,62823150,62823151,62823152,62823153,62823154,62823155,62823156,62823157,62823158,62823159,62823160,62823161,62823162,62823163,62823164,62823165,62823166,62823167,62823168,62823169,62823170,62823171,62823172,62823173,62823174,62823175,62823176,62823177,62823178,62823179,62823180,62823181,62823182,62823183,62823184,62823185,62823186,62823187,62823188,62823189,62823190,62823191,62823192,62823193,62823194,62823195,62823196,62823197,62823198,62823199,62823200,62823201,62823202,62823203,62823204,62823205,62823206,62823207,62823208,62823209,62823210,62823211,62823212,62823213,62823214,62823215,62823216,62823217,62823218,62823219,62851000,62851001,62851002,62851003,62851004,62851005,62851006,62851007,62851008,62851009,62851010,62851011,62851012,62851013,62851014,62851015,62851016,62851017,62851018,62851019,62851020,62851021,62851022,62851023,62851024,62851025,62851026,62851027,62851028,62851029,62851100,62851101,62851102,62851103,62851104,62851105,62851106,62851107,62851108,62851109,62851110,62851111,62851112,62851113,62851114,62851115,62851116,62851117,62851118,62851119,62851120,62851121,62851122,62851123,62851124,62851125,62851126,62851127,62851128,62851129,62851150,62851151,62851152,62851153,62851154,62851155,62851156,62851157,62851158,62851159,62851160,62851161,62851162,62851163,62851164,62851165,62851166,62851167,62851168,62851169,62851170,62851171,62851172,62851173,62851174,62851175,62851176,62851177,62851178,62851179,62851180,62851181,62851182,62851183,62851184,62851185,62851186,62851187,62851188,62851189,62851190,62851191,62851192,62851193,62851194,62851195,62851196,62851197,62851198,62851199,62851200,62851201,62851202,62851203,62851204,62851205,62851206,62851207,62851208,62851209,62851210,62851211,62851212,62851213,62851214,62851215,62851216,62851217,62851218,62851219,62851920,62851921,62851922,62851923,62851924,62851925,62851926,62851927,62851928,62851929,62851930,62851931,62851932,62851933,62851934,62851935,62851936,62851937,62851938,62851939,62851940,62851941,62851942,62851943,62851944,62851945,62851946,62851947,62851948,62851949,62851950,62851951,62851952,62851953,62851954,62851955,62851956,62851957,62851958,62851959,62851960,62851961,62851962,62851963,62851964,62851965,62851966,62851967,62851968,62851969,62852100,62852101,62852102,62852103,62852104,62852105,62852106,62852107,62852108,62852109,62852110,62852111,62852112,62852113,62852114,62852115,62852116,62852117,62852118,62852119,62852120,62852121,62852122,62852123,62852124,62852125,62852126,62852127,62852128,62852129,62852130,62852131,62852132,62852133,62852134,62852135,62852136,62852137,62852138,62852139,62852140,62852141,62852142,62852143,62852144,62852145,62852146,62852147,62852148,62852149,62852150,62852151,62852152,62852153,62852154,62852155,62852156,62852157,62852158,62852159,62852160,62852161,62852162,62852163,62852164,62852165,62852166,62852167,62852168,62852169,62852170,62852171,62852172,62852173,62852174,62852175,62852176,62852177,62852178,62852179,62852180,62852181,62852182,62852183,62852184,62852185,62852186,62852187,62852188,62852189,62852190,62852191,62852192,62852193,62852194,62852195,62852196,62852197,62852198,62852199,62852200,62852201,62852202,62852203,62852204,62852205,62852206,62852207,62852208,62852209,62852210,62852211,62852212,62852213,62852214,62852215,62852216,62852217,62852218,62852219,62852220,62852221,62852222,62852223,62852224,62852225,62852226,62852227,62852228,62852229,62852230,62852231,62852232,62852233,62852234,62852235,62852236,62852237,62852238,62852239,62852240,62852241,62852242,62852243,62852244,62852245,62852246,62852247,62852248,62852249,62852800,62852801,62852802,62852803,62852804,62852805,62852806,62852807,62852808,62852809,62852810,62852811,62852812,62852813,62852814,62852815,62852816,62852817,62852818,62852819,62852820,62852821,62852822,62852823,62852824,62852825,62852826,62852827,62852828,62852829,62852830,62852831,62852832,62852833,62852834,62852835,62852836,62852837,62852838,62852839,62852840,62852841,62852842,62852843,62852844,62852845,62852846,62852847,62852848,62852849,62852850,62852851,62852852,62852853,62852854,62852855,62852856,62852857,62852858,62852859,62852860,62852861,62852862,62852863,62852864,62852865,62852866,62852867,62852868,62852869,62852870,62852871,62852872,62852873,62852874,62852875,62852876,62852877,62852878,62852879,62852880,62852881,62852882,62852883,62852884,62852885,62852886,62852887,62852888,62852889,62852890,62852891,62852892,62852893,62852894,62852895,62852896,62852897,62852898,62852899,62852940,62852941,62852942,62852943,62852944,62852945,62852946,62852947,62852948,62852949,62852950,62852951,62852952,62852953,62852954,62852955,62852956,62852957,62852958,62852959,62853002,62853023,62853025,62853026,62853100,62853101,62853102,62853103,62853104,62853105,62853106,62853107,62853108,62853109,62853110,62853111,62853112,62853113,62853114,62853115,62853116,62853117,62853118,62853119,62853120,62853121,62853122,62853123,62853124,62853125,62853126,62853127,62853128,62853129,62853130,62853131,62853132,62853133,62853134,62853135,62853136,62853137,62853138,62853139,62853140,62853141,62853142,62853143,62853144,62853145,62853146,62853147,62853148,62853149,62853150,62853151,62853152,62853153,62853154,62853155,62853156,62853157,62853158,62853159,62853160,62853161,62853162,62853163,62853164,62853165,62853166,62853167,62853168,62853169,62853170,62853171,62853172,62853173,62853174,62853175,62853176,62853177,62853178,62853179,62853180,62853181,62853182,62853183,62853184,62853185,62853186,62853187,62853188,62853189,62853190,62853191,62853192,62853193,62853194,62853195,62853196,62853197,62853198,62853199,62853200,62853201,62853202,62853203,62853204,62853205,62853206,62853207,62853208,62853209,62853210,62853211,62853212,62853213,62853214,62853215,62853216,62853217,62853218,62853219,62853220,62853221,62853222,62853223,62853224,62853225,62853226,62853227,62853228,62853229,62853230,62853231,62853232,62853233,62853234,62853235,62853236,62853237,62853238,62853239,62853240,62853241,62853242,62853243,62853244,62853245,62853246,62853247,62853248,62853249,62853510,62853511,62853512,62853513,62853514,62853515,62853516,62853517,62853518,62853519,62853520,62853521,62853522,62853523,62853524,62853525,62853526,62853527,62853528,62853529,62853530,62853531,62853532,62853533,62853534,62853535,62853536,62853537,62853538,62853539,62853026
		) ");	
		$sales_result=$sales_query->row();

		//churn
		$churn_query=$this->db2->query("SELECT count(*) amount
		FROM
		  V_CM_DEACTIVATION_2018 
		WHERE TYPE IN ('R','S')  AND DATE_FORMAT(last_date_modification,'%Y-%m-%d') between ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'
		  AND SALESCHURN_TRACK = 'Y'  
		  AND SUBSTR(msisdn, 1, 8) IN (
		62811100,62811101,62811102,62811103,62811104,62811105,62811106,62811107,62811108,62811109,62811110,62811111,62811112,62811113,62811114,62811115,62811116,62811117,62811118,62811119,62811120,62811121,62811122,62811123,62811124,62811125,62811126,62811127,62811128,62811129,62811130,62811131,62811132,62811133,62811134,62811135,62811136,62811137,62811138,62811139,62811140,62811141,62811142,62811143,62811144,62811145,62811146,62811147,62811148,62811149,62811150,62811151,62811152,62811153,62811154,62811155,62811156,62811157,62811158,62811159,62811160,62811161,62811162,62811163,62811164,62811165,62811166,62811167,62811168,62811169,62811170,62811171,62811172,62811173,62811174,62811175,62811176,62811177,62811178,62811179,62811180,62811181,62811182,62811183,62811184,62811185,62811186,62811187,62811188,62811189,62811190,62811191,62811192,62811193,62811194,62811195,62811196,62811197,62811198,62811199,62811200,62811201,62811202,62811203,62811204,62811205,62811206,62811207,62811208,62811209,62811210,62811211,62811212,62811213,62811214,62811215,62811216,62811217,62811218,62811219,62811220,62811221,62811222,62811223,62811224,62811225,62811226,62811227,62811228,62811229,62811230,62811231,62811232,62811233,62811234,62811235,62811236,62811237,62811238,62811239,62811240,62811241,62811242,62811243,62811244,62811245,62811246,62811247,62811248,62811249,62811800,62811801,62811802,62811803,62811804,62811805,62811806,62811807,62811808,62811809,62811810,62811811,62811812,62811813,62811814,62811815,62811816,62811817,62811818,62811819,62811820,62811821,62811822,62811823,62811824,62811825,62811826,62811827,62811828,62811829,62811830,62811831,62811832,62811833,62811834,62811835,62811836,62811837,62811838,62811839,62811840,62811841,62811842,62811843,62811844,62811845,62811846,62811847,62811848,62811849,62811850,62811851,62811852,62811853,62811854,62811855,62811856,62811857,62811858,62811859,62811860,62811861,62811862,62811863,62811864,62811865,62811866,62811867,62811868,62811869,62811870,62811871,62811872,62811873,62811874,62811875,62811876,62811877,62811878,62811879,62811880,62811881,62811882,62811883,62811884,62811885,62811886,62811887,62811888,62811889,62811890,62811891,62811892,62811893,62811894,62811895,62811896,62811897,62811898,62811899,62811900,62811901,62811902,62811903,62811904,62811905,62811906,62811907,62811908,62811909,62811910,62811911,62811912,62811913,62811914,62811915,62811916,62811917,62811918,62811919,62811920,62811921,62811922,62811923,62811924,62811925,62811926,62811927,62811928,62811929,62811930,62811931,62811932,62811933,62811934,62811935,62811936,62811937,62811938,62811939,62811940,62811941,62811942,62811943,62811944,62811945,62811946,62811947,62811948,62811949,62811950,62811951,62811952,62811953,62811954,62811955,62811956,62811957,62811958,62811959,62811960,62811961,62811962,62811963,62811964,62811965,62811966,62811967,62811968,62811969,62811970,62811971,62811972,62811973,62811974,62811975,62811976,62811977,62811978,62811979,62811980,62811981,62811982,62811983,62811984,62811985,62811986,62811987,62811988,62811989,62811990,62811991,62811992,62811993,62811994,62811995,62811996,62811997,62811998,62811999,62812100,62812101,62812102,62812103,62812104,62812105,62812106,62812107,62812108,62812109,62812110,62812111,62812112,62812113,62812114,62812115,62812116,62812117,62812118,62812119,62812120,62812121,62812122,62812123,62812124,62812125,62812126,62812127,62812128,62812129,62812130,62812131,62812132,62812133,62812134,62812135,62812136,62812137,62812138,62812139,62812140,62812141,62812142,62812143,62812144,62812145,62812146,62812147,62812148,62812149,62812180,62812181,62812182,62812183,62812184,62812185,62812186,62812187,62812188,62812189,62812190,62812191,62812192,62812193,62812194,62812195,62812196,62812197,62812198,62812199,62812200,62812201,62812202,62812203,62812204,62812205,62812206,62812207,62812208,62812209,62812210,62812211,62812212,62812213,62812214,62812215,62812216,62812217,62812218,62812219,62812220,62812221,62812222,62812223,62812224,62812225,62812226,62812227,62812228,62812229,62812230,62812231,62812232,62812233,62812234,62812235,62812236,62812237,62812238,62812239,62812240,62812241,62812242,62812243,62812244,62812245,62812246,62812247,62812248,62812249,62812800,62812801,62812802,62812803,62812804,62812805,62812806,62812807,62812808,62812809,62812810,62812811,62812812,62812813,62812814,62812815,62812816,62812817,62812818,62812819,62812820,62812821,62812822,62812823,62812824,62812825,62812826,62812827,62812828,62812829,62812830,62812831,62812832,62812833,62812834,62812835,62812836,62812837,62812838,62812839,62812840,62812841,62812842,62812843,62812844,62812845,62812846,62812847,62812848,62812849,62812850,62812851,62812852,62812853,62812854,62812855,62812856,62812857,62812858,62812859,62812860,62812861,62812862,62812863,62812864,62812865,62812866,62812867,62812868,62812869,62812870,62812871,62812872,62812873,62812874,62812875,62812876,62812877,62812878,62812879,62812880,62812881,62812882,62812883,62812884,62812885,62812886,62812887,62812888,62812889,62812890,62812891,62812892,62812893,62812894,62812895,62812896,62812897,62812898,62812899,62812900,62812901,62812902,62812903,62812904,62812905,62812906,62812907,62812908,62812909,62812910,62812911,62812912,62812913,62812914,62812915,62812916,62812917,62812918,62812919,62812920,62812921,62812922,62812923,62812924,62812925,62812926,62812927,62812928,62812929,62812930,62812931,62812932,62812933,62812934,62812935,62812936,62812937,62812938,62812939,62812940,62812941,62812942,62812943,62812944,62812945,62812946,62812947,62812948,62812949,62812950,62812951,62812952,62812953,62812954,62812955,62812956,62812957,62812958,62812959,62812960,62812961,62812962,62812963,62812964,62812965,62812966,62812967,62812968,62812969,62812970,62812971,62812972,62812973,62812974,62812975,62812976,62812977,62812978,62812979,62812980,62812981,62812982,62812983,62812984,62812985,62812986,62812987,62812988,62812989,62812990,62812991,62812992,62812993,62812994,62812995,62812996,62812997,62812998,62812999,62813100,62813101,62813102,62813103,62813104,62813105,62813106,62813107,62813108,62813109,62813110,62813111,62813112,62813113,62813114,62813115,62813116,62813117,62813118,62813119,62813120,62813121,62813122,62813123,62813124,62813125,62813126,62813127,62813128,62813129,62813130,62813131,62813132,62813133,62813134,62813135,62813136,62813137,62813138,62813139,62813140,62813141,62813142,62813143,62813144,62813145,62813146,62813147,62813148,62813149,62813150,62813151,62813152,62813153,62813154,62813155,62813156,62813157,62813158,62813159,62813160,62813161,62813162,62813163,62813164,62813165,62813166,62813167,62813168,62813169,62813170,62813171,62813172,62813173,62813174,62813175,62813176,62813177,62813178,62813179,62813180,62813181,62813182,62813183,62813184,62813185,62813186,62813187,62813188,62813189,62813190,62813191,62813192,62813193,62813194,62813195,62813196,62813197,62813198,62813199,62813200,62813201,62813202,62813203,62813204,62813205,62813206,62813207,62813208,62813209,62813210,62813211,62813212,62813213,62813214,62813215,62813216,62813217,62813218,62813219,62813220,62813221,62813222,62813223,62813224,62813225,62813226,62813227,62813228,62813229,62813230,62813231,62813232,62813233,62813234,62813235,62813236,62813237,62813238,62813239,62813240,62813241,62813242,62813243,62813244,62813245,62813246,62813247,62813248,62813249,62813800,62813801,62813802,62813803,62813804,62813805,62813806,62813807,62813808,62813809,62813810,62813811,62813812,62813813,62813814,62813815,62813816,62813817,62813818,62813819,62813820,62813821,62813822,62813823,62813824,62813825,62813826,62813827,62813828,62813829,62813830,62813831,62813832,62813833,62813834,62813835,62813836,62813837,62813838,62813839,62813840,62813841,62813842,62813843,62813844,62813845,62813846,62813847,62813848,62813849,62813850,62813851,62813852,62813853,62813854,62813855,62813856,62813857,62813858,62813859,62813860,62813861,62813862,62813863,62813864,62813865,62813866,62813867,62813868,62813869,62813870,62813871,62813872,62813873,62813874,62813875,62813876,62813877,62813878,62813879,62813880,62813881,62813882,62813883,62813884,62813885,62813886,62813887,62813888,62813889,62813890,62813891,62813892,62813893,62813894,62813895,62813896,62813897,62813898,62813899,62813940,62813941,62813942,62813943,62813944,62813945,62813946,62813947,62813948,62813949,62813950,62813951,62813952,62813953,62813954,62813955,62813956,62813957,62813958,62813959,62813980,62813981,62813982,62813983,62813984,62813985,62813986,62813987,62813988,62813989,62813990,62813991,62813992,62813993,62813994,62813995,62813996,62813997,62813998,62813999,62821100,62821101,62821102,62821103,62821104,62821105,62821106,62821107,62821108,62821109,62821110,62821111,62821112,62821113,62821114,62821115,62821116,62821117,62821118,62821119,62821120,62821121,62821122,62821123,62821124,62821125,62821126,62821127,62821128,62821129,62821130,62821131,62821132,62821133,62821134,62821135,62821136,62821137,62821138,62821139,62821140,62821141,62821142,62821143,62821144,62821145,62821146,62821147,62821148,62821149,62821150,62821151,62821152,62821153,62821154,62821155,62821156,62821157,62821158,62821159,62821160,62821161,62821162,62821163,62821164,62821165,62821166,62821167,62821168,62821169,62821170,62821171,62821172,62821173,62821174,62821175,62821176,62821177,62821178,62821179,62821180,62821181,62821182,62821183,62821184,62821185,62821186,62821187,62821188,62821189,62821190,62821191,62821192,62821193,62821194,62821195,62821196,62821197,62821198,62821199,62821200,62821201,62821202,62821203,62821204,62821205,62821206,62821207,62821208,62821209,62821210,62821211,62821212,62821213,62821214,62821215,62821216,62821217,62821218,62821219,62821220,62821221,62821222,62821223,62821224,62821225,62821226,62821227,62821228,62821229,62821230,62821231,62821232,62821233,62821234,62821235,62821236,62821237,62821238,62821239,62821240,62821241,62821242,62821243,62821244,62821245,62821246,62821247,62821248,62821249,62821250,62821251,62821252,62821253,62821254,62821255,62821256,62821257,62821258,62821259,62821260,62821261,62821262,62821263,62821264,62821265,62821266,62821267,62821268,62821269,62821270,62821271,62821272,62821273,62821274,62821275,62821276,62821277,62821278,62821279,62821280,62821281,62821282,62821283,62821284,62821285,62821286,62821287,62821288,62821289,62821290,62821291,62821292,62821293,62821294,62821295,62821296,62821297,62821298,62821299,62821300,62821301,62821302,62821303,62821304,62821305,62821306,62821307,62821308,62821309,62822080,62822081,62822082,62822083,62822084,62822085,62822086,62822087,62822088,62822089,62822100,62822101,62822102,62822103,62822104,62822105,62822106,62822107,62822108,62822109,62822110,62822111,62822112,62822113,62822114,62822115,62822116,62822117,62822118,62822119,62822120,62822121,62822122,62822123,62822124,62822125,62822126,62822127,62822128,62822129,62822130,62822131,62822132,62822133,62822134,62822135,62822136,62822137,62822138,62822139,62822140,62822141,62822142,62822143,62822144,62822145,62822146,62822147,62822148,62822149,62822150,62822151,62822152,62822153,62822154,62822155,62822156,62822157,62822158,62822159,62822160,62822161,62822162,62822163,62822164,62822165,62822166,62822167,62822168,62822169,62822170,62822171,62822172,62822173,62822174,62822175,62822176,62822177,62822178,62822179,62822180,62822181,62822182,62822183,62822184,62822185,62822186,62822187,62822188,62822189,62822190,62822191,62822192,62822193,62822194,62822195,62822196,62822197,62822198,62822199,62822400,62822401,62822402,62822403,62822404,62822405,62822406,62822407,62822408,62822409,62822600,62822601,62822602,62822603,62822604,62822605,62822606,62822607,62822608,62822609,62822610,62822611,62822612,62822613,62822614,62822615,62822616,62822617,62822618,62822619,62822620,62822621,62822622,62822623,62822624,62822625,62822626,62822627,62822628,62822629,62822630,62822631,62822632,62822633,62822634,62822635,62822636,62822637,62822638,62822639,62822950,62822951,62822952,62822953,62822954,62822955,62822956,62822957,62822958,62822959,62822970,62822971,62822972,62822973,62822974,62822975,62822976,62822977,62822978,62822979,62822980,62822981,62822982,62822983,62822984,62822985,62822986,62822987,62822988,62822989,62822990,62822991,62822992,62822993,62822994,62822995,62822996,62822997,62822998,62822999,62823100,62823101,62823102,62823103,62823104,62823105,62823106,62823107,62823108,62823109,62823110,62823111,62823112,62823113,62823114,62823115,62823116,62823117,62823118,62823119,62823120,62823121,62823122,62823123,62823124,62823125,62823126,62823127,62823128,62823129,62823150,62823151,62823152,62823153,62823154,62823155,62823156,62823157,62823158,62823159,62823160,62823161,62823162,62823163,62823164,62823165,62823166,62823167,62823168,62823169,62823170,62823171,62823172,62823173,62823174,62823175,62823176,62823177,62823178,62823179,62823180,62823181,62823182,62823183,62823184,62823185,62823186,62823187,62823188,62823189,62823190,62823191,62823192,62823193,62823194,62823195,62823196,62823197,62823198,62823199,62823200,62823201,62823202,62823203,62823204,62823205,62823206,62823207,62823208,62823209,62823210,62823211,62823212,62823213,62823214,62823215,62823216,62823217,62823218,62823219,62851000,62851001,62851002,62851003,62851004,62851005,62851006,62851007,62851008,62851009,62851010,62851011,62851012,62851013,62851014,62851015,62851016,62851017,62851018,62851019,62851020,62851021,62851022,62851023,62851024,62851025,62851026,62851027,62851028,62851029,62851100,62851101,62851102,62851103,62851104,62851105,62851106,62851107,62851108,62851109,62851110,62851111,62851112,62851113,62851114,62851115,62851116,62851117,62851118,62851119,62851120,62851121,62851122,62851123,62851124,62851125,62851126,62851127,62851128,62851129,62851150,62851151,62851152,62851153,62851154,62851155,62851156,62851157,62851158,62851159,62851160,62851161,62851162,62851163,62851164,62851165,62851166,62851167,62851168,62851169,62851170,62851171,62851172,62851173,62851174,62851175,62851176,62851177,62851178,62851179,62851180,62851181,62851182,62851183,62851184,62851185,62851186,62851187,62851188,62851189,62851190,62851191,62851192,62851193,62851194,62851195,62851196,62851197,62851198,62851199,62851200,62851201,62851202,62851203,62851204,62851205,62851206,62851207,62851208,62851209,62851210,62851211,62851212,62851213,62851214,62851215,62851216,62851217,62851218,62851219,62851920,62851921,62851922,62851923,62851924,62851925,62851926,62851927,62851928,62851929,62851930,62851931,62851932,62851933,62851934,62851935,62851936,62851937,62851938,62851939,62851940,62851941,62851942,62851943,62851944,62851945,62851946,62851947,62851948,62851949,62851950,62851951,62851952,62851953,62851954,62851955,62851956,62851957,62851958,62851959,62851960,62851961,62851962,62851963,62851964,62851965,62851966,62851967,62851968,62851969,62852100,62852101,62852102,62852103,62852104,62852105,62852106,62852107,62852108,62852109,62852110,62852111,62852112,62852113,62852114,62852115,62852116,62852117,62852118,62852119,62852120,62852121,62852122,62852123,62852124,62852125,62852126,62852127,62852128,62852129,62852130,62852131,62852132,62852133,62852134,62852135,62852136,62852137,62852138,62852139,62852140,62852141,62852142,62852143,62852144,62852145,62852146,62852147,62852148,62852149,62852150,62852151,62852152,62852153,62852154,62852155,62852156,62852157,62852158,62852159,62852160,62852161,62852162,62852163,62852164,62852165,62852166,62852167,62852168,62852169,62852170,62852171,62852172,62852173,62852174,62852175,62852176,62852177,62852178,62852179,62852180,62852181,62852182,62852183,62852184,62852185,62852186,62852187,62852188,62852189,62852190,62852191,62852192,62852193,62852194,62852195,62852196,62852197,62852198,62852199,62852200,62852201,62852202,62852203,62852204,62852205,62852206,62852207,62852208,62852209,62852210,62852211,62852212,62852213,62852214,62852215,62852216,62852217,62852218,62852219,62852220,62852221,62852222,62852223,62852224,62852225,62852226,62852227,62852228,62852229,62852230,62852231,62852232,62852233,62852234,62852235,62852236,62852237,62852238,62852239,62852240,62852241,62852242,62852243,62852244,62852245,62852246,62852247,62852248,62852249,62852800,62852801,62852802,62852803,62852804,62852805,62852806,62852807,62852808,62852809,62852810,62852811,62852812,62852813,62852814,62852815,62852816,62852817,62852818,62852819,62852820,62852821,62852822,62852823,62852824,62852825,62852826,62852827,62852828,62852829,62852830,62852831,62852832,62852833,62852834,62852835,62852836,62852837,62852838,62852839,62852840,62852841,62852842,62852843,62852844,62852845,62852846,62852847,62852848,62852849,62852850,62852851,62852852,62852853,62852854,62852855,62852856,62852857,62852858,62852859,62852860,62852861,62852862,62852863,62852864,62852865,62852866,62852867,62852868,62852869,62852870,62852871,62852872,62852873,62852874,62852875,62852876,62852877,62852878,62852879,62852880,62852881,62852882,62852883,62852884,62852885,62852886,62852887,62852888,62852889,62852890,62852891,62852892,62852893,62852894,62852895,62852896,62852897,62852898,62852899,62852940,62852941,62852942,62852943,62852944,62852945,62852946,62852947,62852948,62852949,62852950,62852951,62852952,62852953,62852954,62852955,62852956,62852957,62852958,62852959,62853002,62853023,62853025,62853026,62853100,62853101,62853102,62853103,62853104,62853105,62853106,62853107,62853108,62853109,62853110,62853111,62853112,62853113,62853114,62853115,62853116,62853117,62853118,62853119,62853120,62853121,62853122,62853123,62853124,62853125,62853126,62853127,62853128,62853129,62853130,62853131,62853132,62853133,62853134,62853135,62853136,62853137,62853138,62853139,62853140,62853141,62853142,62853143,62853144,62853145,62853146,62853147,62853148,62853149,62853150,62853151,62853152,62853153,62853154,62853155,62853156,62853157,62853158,62853159,62853160,62853161,62853162,62853163,62853164,62853165,62853166,62853167,62853168,62853169,62853170,62853171,62853172,62853173,62853174,62853175,62853176,62853177,62853178,62853179,62853180,62853181,62853182,62853183,62853184,62853185,62853186,62853187,62853188,62853189,62853190,62853191,62853192,62853193,62853194,62853195,62853196,62853197,62853198,62853199,62853200,62853201,62853202,62853203,62853204,62853205,62853206,62853207,62853208,62853209,62853210,62853211,62853212,62853213,62853214,62853215,62853216,62853217,62853218,62853219,62853220,62853221,62853222,62853223,62853224,62853225,62853226,62853227,62853228,62853229,62853230,62853231,62853232,62853233,62853234,62853235,62853236,62853237,62853238,62853239,62853240,62853241,62853242,62853243,62853244,62853245,62853246,62853247,62853248,62853249,62853510,62853511,62853512,62853513,62853514,62853515,62853516,62853517,62853518,62853519,62853520,62853521,62853522,62853523,62853524,62853525,62853526,62853527,62853528,62853529,62853530,62853531,62853532,62853533,62853534,62853535,62853536,62853537,62853538,62853539,62853026
		)");	
		$churn_result=$churn_query->row();

		$bulan  = date('m', strtotime($date));
		$tahun  = date('Y', strtotime($date));
		$revenue_query=$this->db2->query("SELECT sum(bbs_totalbill_$bulan) amount
			FROM
			T_MASTER_CUSTBASE_REGULAR_AREA 
			WHERE data_year = '$tahun' 
			AND CUSTOMER_TYPE IN ('R', 'S') 
			AND isreg_$bulan IN ('Y', 'B') 
			AND SUBSTR(msisdn, 1, 8) IN (
		62811100,62811101,62811102,62811103,62811104,62811105,62811106,62811107,62811108,62811109,62811110,62811111,62811112,62811113,62811114,62811115,62811116,62811117,62811118,62811119,62811120,62811121,62811122,62811123,62811124,62811125,62811126,62811127,62811128,62811129,62811130,62811131,62811132,62811133,62811134,62811135,62811136,62811137,62811138,62811139,62811140,62811141,62811142,62811143,62811144,62811145,62811146,62811147,62811148,62811149,62811150,62811151,62811152,62811153,62811154,62811155,62811156,62811157,62811158,62811159,62811160,62811161,62811162,62811163,62811164,62811165,62811166,62811167,62811168,62811169,62811170,62811171,62811172,62811173,62811174,62811175,62811176,62811177,62811178,62811179,62811180,62811181,62811182,62811183,62811184,62811185,62811186,62811187,62811188,62811189,62811190,62811191,62811192,62811193,62811194,62811195,62811196,62811197,62811198,62811199,62811200,62811201,62811202,62811203,62811204,62811205,62811206,62811207,62811208,62811209,62811210,62811211,62811212,62811213,62811214,62811215,62811216,62811217,62811218,62811219,62811220,62811221,62811222,62811223,62811224,62811225,62811226,62811227,62811228,62811229,62811230,62811231,62811232,62811233,62811234,62811235,62811236,62811237,62811238,62811239,62811240,62811241,62811242,62811243,62811244,62811245,62811246,62811247,62811248,62811249,62811800,62811801,62811802,62811803,62811804,62811805,62811806,62811807,62811808,62811809,62811810,62811811,62811812,62811813,62811814,62811815,62811816,62811817,62811818,62811819,62811820,62811821,62811822,62811823,62811824,62811825,62811826,62811827,62811828,62811829,62811830,62811831,62811832,62811833,62811834,62811835,62811836,62811837,62811838,62811839,62811840,62811841,62811842,62811843,62811844,62811845,62811846,62811847,62811848,62811849,62811850,62811851,62811852,62811853,62811854,62811855,62811856,62811857,62811858,62811859,62811860,62811861,62811862,62811863,62811864,62811865,62811866,62811867,62811868,62811869,62811870,62811871,62811872,62811873,62811874,62811875,62811876,62811877,62811878,62811879,62811880,62811881,62811882,62811883,62811884,62811885,62811886,62811887,62811888,62811889,62811890,62811891,62811892,62811893,62811894,62811895,62811896,62811897,62811898,62811899,62811900,62811901,62811902,62811903,62811904,62811905,62811906,62811907,62811908,62811909,62811910,62811911,62811912,62811913,62811914,62811915,62811916,62811917,62811918,62811919,62811920,62811921,62811922,62811923,62811924,62811925,62811926,62811927,62811928,62811929,62811930,62811931,62811932,62811933,62811934,62811935,62811936,62811937,62811938,62811939,62811940,62811941,62811942,62811943,62811944,62811945,62811946,62811947,62811948,62811949,62811950,62811951,62811952,62811953,62811954,62811955,62811956,62811957,62811958,62811959,62811960,62811961,62811962,62811963,62811964,62811965,62811966,62811967,62811968,62811969,62811970,62811971,62811972,62811973,62811974,62811975,62811976,62811977,62811978,62811979,62811980,62811981,62811982,62811983,62811984,62811985,62811986,62811987,62811988,62811989,62811990,62811991,62811992,62811993,62811994,62811995,62811996,62811997,62811998,62811999,62812100,62812101,62812102,62812103,62812104,62812105,62812106,62812107,62812108,62812109,62812110,62812111,62812112,62812113,62812114,62812115,62812116,62812117,62812118,62812119,62812120,62812121,62812122,62812123,62812124,62812125,62812126,62812127,62812128,62812129,62812130,62812131,62812132,62812133,62812134,62812135,62812136,62812137,62812138,62812139,62812140,62812141,62812142,62812143,62812144,62812145,62812146,62812147,62812148,62812149,62812180,62812181,62812182,62812183,62812184,62812185,62812186,62812187,62812188,62812189,62812190,62812191,62812192,62812193,62812194,62812195,62812196,62812197,62812198,62812199,62812200,62812201,62812202,62812203,62812204,62812205,62812206,62812207,62812208,62812209,62812210,62812211,62812212,62812213,62812214,62812215,62812216,62812217,62812218,62812219,62812220,62812221,62812222,62812223,62812224,62812225,62812226,62812227,62812228,62812229,62812230,62812231,62812232,62812233,62812234,62812235,62812236,62812237,62812238,62812239,62812240,62812241,62812242,62812243,62812244,62812245,62812246,62812247,62812248,62812249,62812800,62812801,62812802,62812803,62812804,62812805,62812806,62812807,62812808,62812809,62812810,62812811,62812812,62812813,62812814,62812815,62812816,62812817,62812818,62812819,62812820,62812821,62812822,62812823,62812824,62812825,62812826,62812827,62812828,62812829,62812830,62812831,62812832,62812833,62812834,62812835,62812836,62812837,62812838,62812839,62812840,62812841,62812842,62812843,62812844,62812845,62812846,62812847,62812848,62812849,62812850,62812851,62812852,62812853,62812854,62812855,62812856,62812857,62812858,62812859,62812860,62812861,62812862,62812863,62812864,62812865,62812866,62812867,62812868,62812869,62812870,62812871,62812872,62812873,62812874,62812875,62812876,62812877,62812878,62812879,62812880,62812881,62812882,62812883,62812884,62812885,62812886,62812887,62812888,62812889,62812890,62812891,62812892,62812893,62812894,62812895,62812896,62812897,62812898,62812899,62812900,62812901,62812902,62812903,62812904,62812905,62812906,62812907,62812908,62812909,62812910,62812911,62812912,62812913,62812914,62812915,62812916,62812917,62812918,62812919,62812920,62812921,62812922,62812923,62812924,62812925,62812926,62812927,62812928,62812929,62812930,62812931,62812932,62812933,62812934,62812935,62812936,62812937,62812938,62812939,62812940,62812941,62812942,62812943,62812944,62812945,62812946,62812947,62812948,62812949,62812950,62812951,62812952,62812953,62812954,62812955,62812956,62812957,62812958,62812959,62812960,62812961,62812962,62812963,62812964,62812965,62812966,62812967,62812968,62812969,62812970,62812971,62812972,62812973,62812974,62812975,62812976,62812977,62812978,62812979,62812980,62812981,62812982,62812983,62812984,62812985,62812986,62812987,62812988,62812989,62812990,62812991,62812992,62812993,62812994,62812995,62812996,62812997,62812998,62812999,62813100,62813101,62813102,62813103,62813104,62813105,62813106,62813107,62813108,62813109,62813110,62813111,62813112,62813113,62813114,62813115,62813116,62813117,62813118,62813119,62813120,62813121,62813122,62813123,62813124,62813125,62813126,62813127,62813128,62813129,62813130,62813131,62813132,62813133,62813134,62813135,62813136,62813137,62813138,62813139,62813140,62813141,62813142,62813143,62813144,62813145,62813146,62813147,62813148,62813149,62813150,62813151,62813152,62813153,62813154,62813155,62813156,62813157,62813158,62813159,62813160,62813161,62813162,62813163,62813164,62813165,62813166,62813167,62813168,62813169,62813170,62813171,62813172,62813173,62813174,62813175,62813176,62813177,62813178,62813179,62813180,62813181,62813182,62813183,62813184,62813185,62813186,62813187,62813188,62813189,62813190,62813191,62813192,62813193,62813194,62813195,62813196,62813197,62813198,62813199,62813200,62813201,62813202,62813203,62813204,62813205,62813206,62813207,62813208,62813209,62813210,62813211,62813212,62813213,62813214,62813215,62813216,62813217,62813218,62813219,62813220,62813221,62813222,62813223,62813224,62813225,62813226,62813227,62813228,62813229,62813230,62813231,62813232,62813233,62813234,62813235,62813236,62813237,62813238,62813239,62813240,62813241,62813242,62813243,62813244,62813245,62813246,62813247,62813248,62813249,62813800,62813801,62813802,62813803,62813804,62813805,62813806,62813807,62813808,62813809,62813810,62813811,62813812,62813813,62813814,62813815,62813816,62813817,62813818,62813819,62813820,62813821,62813822,62813823,62813824,62813825,62813826,62813827,62813828,62813829,62813830,62813831,62813832,62813833,62813834,62813835,62813836,62813837,62813838,62813839,62813840,62813841,62813842,62813843,62813844,62813845,62813846,62813847,62813848,62813849,62813850,62813851,62813852,62813853,62813854,62813855,62813856,62813857,62813858,62813859,62813860,62813861,62813862,62813863,62813864,62813865,62813866,62813867,62813868,62813869,62813870,62813871,62813872,62813873,62813874,62813875,62813876,62813877,62813878,62813879,62813880,62813881,62813882,62813883,62813884,62813885,62813886,62813887,62813888,62813889,62813890,62813891,62813892,62813893,62813894,62813895,62813896,62813897,62813898,62813899,62813940,62813941,62813942,62813943,62813944,62813945,62813946,62813947,62813948,62813949,62813950,62813951,62813952,62813953,62813954,62813955,62813956,62813957,62813958,62813959,62813980,62813981,62813982,62813983,62813984,62813985,62813986,62813987,62813988,62813989,62813990,62813991,62813992,62813993,62813994,62813995,62813996,62813997,62813998,62813999,62821100,62821101,62821102,62821103,62821104,62821105,62821106,62821107,62821108,62821109,62821110,62821111,62821112,62821113,62821114,62821115,62821116,62821117,62821118,62821119,62821120,62821121,62821122,62821123,62821124,62821125,62821126,62821127,62821128,62821129,62821130,62821131,62821132,62821133,62821134,62821135,62821136,62821137,62821138,62821139,62821140,62821141,62821142,62821143,62821144,62821145,62821146,62821147,62821148,62821149,62821150,62821151,62821152,62821153,62821154,62821155,62821156,62821157,62821158,62821159,62821160,62821161,62821162,62821163,62821164,62821165,62821166,62821167,62821168,62821169,62821170,62821171,62821172,62821173,62821174,62821175,62821176,62821177,62821178,62821179,62821180,62821181,62821182,62821183,62821184,62821185,62821186,62821187,62821188,62821189,62821190,62821191,62821192,62821193,62821194,62821195,62821196,62821197,62821198,62821199,62821200,62821201,62821202,62821203,62821204,62821205,62821206,62821207,62821208,62821209,62821210,62821211,62821212,62821213,62821214,62821215,62821216,62821217,62821218,62821219,62821220,62821221,62821222,62821223,62821224,62821225,62821226,62821227,62821228,62821229,62821230,62821231,62821232,62821233,62821234,62821235,62821236,62821237,62821238,62821239,62821240,62821241,62821242,62821243,62821244,62821245,62821246,62821247,62821248,62821249,62821250,62821251,62821252,62821253,62821254,62821255,62821256,62821257,62821258,62821259,62821260,62821261,62821262,62821263,62821264,62821265,62821266,62821267,62821268,62821269,62821270,62821271,62821272,62821273,62821274,62821275,62821276,62821277,62821278,62821279,62821280,62821281,62821282,62821283,62821284,62821285,62821286,62821287,62821288,62821289,62821290,62821291,62821292,62821293,62821294,62821295,62821296,62821297,62821298,62821299,62821300,62821301,62821302,62821303,62821304,62821305,62821306,62821307,62821308,62821309,62822080,62822081,62822082,62822083,62822084,62822085,62822086,62822087,62822088,62822089,62822100,62822101,62822102,62822103,62822104,62822105,62822106,62822107,62822108,62822109,62822110,62822111,62822112,62822113,62822114,62822115,62822116,62822117,62822118,62822119,62822120,62822121,62822122,62822123,62822124,62822125,62822126,62822127,62822128,62822129,62822130,62822131,62822132,62822133,62822134,62822135,62822136,62822137,62822138,62822139,62822140,62822141,62822142,62822143,62822144,62822145,62822146,62822147,62822148,62822149,62822150,62822151,62822152,62822153,62822154,62822155,62822156,62822157,62822158,62822159,62822160,62822161,62822162,62822163,62822164,62822165,62822166,62822167,62822168,62822169,62822170,62822171,62822172,62822173,62822174,62822175,62822176,62822177,62822178,62822179,62822180,62822181,62822182,62822183,62822184,62822185,62822186,62822187,62822188,62822189,62822190,62822191,62822192,62822193,62822194,62822195,62822196,62822197,62822198,62822199,62822400,62822401,62822402,62822403,62822404,62822405,62822406,62822407,62822408,62822409,62822600,62822601,62822602,62822603,62822604,62822605,62822606,62822607,62822608,62822609,62822610,62822611,62822612,62822613,62822614,62822615,62822616,62822617,62822618,62822619,62822620,62822621,62822622,62822623,62822624,62822625,62822626,62822627,62822628,62822629,62822630,62822631,62822632,62822633,62822634,62822635,62822636,62822637,62822638,62822639,62822950,62822951,62822952,62822953,62822954,62822955,62822956,62822957,62822958,62822959,62822970,62822971,62822972,62822973,62822974,62822975,62822976,62822977,62822978,62822979,62822980,62822981,62822982,62822983,62822984,62822985,62822986,62822987,62822988,62822989,62822990,62822991,62822992,62822993,62822994,62822995,62822996,62822997,62822998,62822999,62823100,62823101,62823102,62823103,62823104,62823105,62823106,62823107,62823108,62823109,62823110,62823111,62823112,62823113,62823114,62823115,62823116,62823117,62823118,62823119,62823120,62823121,62823122,62823123,62823124,62823125,62823126,62823127,62823128,62823129,62823150,62823151,62823152,62823153,62823154,62823155,62823156,62823157,62823158,62823159,62823160,62823161,62823162,62823163,62823164,62823165,62823166,62823167,62823168,62823169,62823170,62823171,62823172,62823173,62823174,62823175,62823176,62823177,62823178,62823179,62823180,62823181,62823182,62823183,62823184,62823185,62823186,62823187,62823188,62823189,62823190,62823191,62823192,62823193,62823194,62823195,62823196,62823197,62823198,62823199,62823200,62823201,62823202,62823203,62823204,62823205,62823206,62823207,62823208,62823209,62823210,62823211,62823212,62823213,62823214,62823215,62823216,62823217,62823218,62823219,62851000,62851001,62851002,62851003,62851004,62851005,62851006,62851007,62851008,62851009,62851010,62851011,62851012,62851013,62851014,62851015,62851016,62851017,62851018,62851019,62851020,62851021,62851022,62851023,62851024,62851025,62851026,62851027,62851028,62851029,62851100,62851101,62851102,62851103,62851104,62851105,62851106,62851107,62851108,62851109,62851110,62851111,62851112,62851113,62851114,62851115,62851116,62851117,62851118,62851119,62851120,62851121,62851122,62851123,62851124,62851125,62851126,62851127,62851128,62851129,62851150,62851151,62851152,62851153,62851154,62851155,62851156,62851157,62851158,62851159,62851160,62851161,62851162,62851163,62851164,62851165,62851166,62851167,62851168,62851169,62851170,62851171,62851172,62851173,62851174,62851175,62851176,62851177,62851178,62851179,62851180,62851181,62851182,62851183,62851184,62851185,62851186,62851187,62851188,62851189,62851190,62851191,62851192,62851193,62851194,62851195,62851196,62851197,62851198,62851199,62851200,62851201,62851202,62851203,62851204,62851205,62851206,62851207,62851208,62851209,62851210,62851211,62851212,62851213,62851214,62851215,62851216,62851217,62851218,62851219,62851920,62851921,62851922,62851923,62851924,62851925,62851926,62851927,62851928,62851929,62851930,62851931,62851932,62851933,62851934,62851935,62851936,62851937,62851938,62851939,62851940,62851941,62851942,62851943,62851944,62851945,62851946,62851947,62851948,62851949,62851950,62851951,62851952,62851953,62851954,62851955,62851956,62851957,62851958,62851959,62851960,62851961,62851962,62851963,62851964,62851965,62851966,62851967,62851968,62851969,62852100,62852101,62852102,62852103,62852104,62852105,62852106,62852107,62852108,62852109,62852110,62852111,62852112,62852113,62852114,62852115,62852116,62852117,62852118,62852119,62852120,62852121,62852122,62852123,62852124,62852125,62852126,62852127,62852128,62852129,62852130,62852131,62852132,62852133,62852134,62852135,62852136,62852137,62852138,62852139,62852140,62852141,62852142,62852143,62852144,62852145,62852146,62852147,62852148,62852149,62852150,62852151,62852152,62852153,62852154,62852155,62852156,62852157,62852158,62852159,62852160,62852161,62852162,62852163,62852164,62852165,62852166,62852167,62852168,62852169,62852170,62852171,62852172,62852173,62852174,62852175,62852176,62852177,62852178,62852179,62852180,62852181,62852182,62852183,62852184,62852185,62852186,62852187,62852188,62852189,62852190,62852191,62852192,62852193,62852194,62852195,62852196,62852197,62852198,62852199,62852200,62852201,62852202,62852203,62852204,62852205,62852206,62852207,62852208,62852209,62852210,62852211,62852212,62852213,62852214,62852215,62852216,62852217,62852218,62852219,62852220,62852221,62852222,62852223,62852224,62852225,62852226,62852227,62852228,62852229,62852230,62852231,62852232,62852233,62852234,62852235,62852236,62852237,62852238,62852239,62852240,62852241,62852242,62852243,62852244,62852245,62852246,62852247,62852248,62852249,62852800,62852801,62852802,62852803,62852804,62852805,62852806,62852807,62852808,62852809,62852810,62852811,62852812,62852813,62852814,62852815,62852816,62852817,62852818,62852819,62852820,62852821,62852822,62852823,62852824,62852825,62852826,62852827,62852828,62852829,62852830,62852831,62852832,62852833,62852834,62852835,62852836,62852837,62852838,62852839,62852840,62852841,62852842,62852843,62852844,62852845,62852846,62852847,62852848,62852849,62852850,62852851,62852852,62852853,62852854,62852855,62852856,62852857,62852858,62852859,62852860,62852861,62852862,62852863,62852864,62852865,62852866,62852867,62852868,62852869,62852870,62852871,62852872,62852873,62852874,62852875,62852876,62852877,62852878,62852879,62852880,62852881,62852882,62852883,62852884,62852885,62852886,62852887,62852888,62852889,62852890,62852891,62852892,62852893,62852894,62852895,62852896,62852897,62852898,62852899,62852940,62852941,62852942,62852943,62852944,62852945,62852946,62852947,62852948,62852949,62852950,62852951,62852952,62852953,62852954,62852955,62852956,62852957,62852958,62852959,62853002,62853023,62853025,62853026,62853100,62853101,62853102,62853103,62853104,62853105,62853106,62853107,62853108,62853109,62853110,62853111,62853112,62853113,62853114,62853115,62853116,62853117,62853118,62853119,62853120,62853121,62853122,62853123,62853124,62853125,62853126,62853127,62853128,62853129,62853130,62853131,62853132,62853133,62853134,62853135,62853136,62853137,62853138,62853139,62853140,62853141,62853142,62853143,62853144,62853145,62853146,62853147,62853148,62853149,62853150,62853151,62853152,62853153,62853154,62853155,62853156,62853157,62853158,62853159,62853160,62853161,62853162,62853163,62853164,62853165,62853166,62853167,62853168,62853169,62853170,62853171,62853172,62853173,62853174,62853175,62853176,62853177,62853178,62853179,62853180,62853181,62853182,62853183,62853184,62853185,62853186,62853187,62853188,62853189,62853190,62853191,62853192,62853193,62853194,62853195,62853196,62853197,62853198,62853199,62853200,62853201,62853202,62853203,62853204,62853205,62853206,62853207,62853208,62853209,62853210,62853211,62853212,62853213,62853214,62853215,62853216,62853217,62853218,62853219,62853220,62853221,62853222,62853223,62853224,62853225,62853226,62853227,62853228,62853229,62853230,62853231,62853232,62853233,62853234,62853235,62853236,62853237,62853238,62853239,62853240,62853241,62853242,62853243,62853244,62853245,62853246,62853247,62853248,62853249,62853510,62853511,62853512,62853513,62853514,62853515,62853516,62853517,62853518,62853519,62853520,62853521,62853522,62853523,62853524,62853525,62853526,62853527,62853528,62853529,62853530,62853531,62853532,62853533,62853534,62853535,62853536,62853537,62853538,62853539,62853026
		)");
		$revenue_result=$revenue_query->row();

		$transaction=array(
			"sales_cm"=>isset($sales_result->amount) ? $sales_result->amount : number_format(0),
			"churn_cm"=> isset($churn_result->amount) ? $churn_result->amount : number_format(0),
			"revenue_cm"=> isset($revenue_result->amount) ? $revenue_result->amount : number_format(0),

		);	

		return $transaction;
	}

	public function dayByDaySales($tgl=""){
		$sukses=array();		
		$pending=array();

		$date=$tgl;	
		// $date=date("Y-m-d");	
		$date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		// $date2=$this->db->query("SELECT LAST_DAY('".$date."') as d")->row()->d;

		$sukses_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$date."') as m_name FROM new_psb where
		status='sukses' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND
		'".$date."' GROUP BY tanggal_aktif")->result();

		// $pending_query=$this->db->query("SELECT DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') as tanggal_validasi ,count(psb_id) as amount,MONTHNAME('".$date."') as m_name FROM new_psb where
		// status='pending' AND DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') between 
		// ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND
		// LAST_DAY('".$date."') GROUP BY tanggal_validasi")->result();

		//For sukses
		$maxsukses=count($sukses_query);
		$i=0;
		//For pending
		// $maxpending=count($pending_query);
		// $j=0;

		$day=1;
		while (strtotime($date1) <= strtotime($date)) {
			//For sukses
			if($maxsukses>0){
				if($date1==$sukses_query[$i]->tanggal_aktif){	
					$sukses[$day]=array(
					"amount"=>$sukses_query[$i]->amount,
					"date"=>$date1,
					"m_name"=>$sukses_query[$i]->m_name
					);

					if($i<($maxsukses-1)){$i++;}
				}else{
					$sukses[$day]=array("amount"=>0,"date"=>$date1,"m_name"=>$sukses_query[$i]->m_name);;	
				}
			}
			//End sukses

			//For pending
			// if($maxpending>0){
			// 	if($date2==$pending_query[$j]->tanggal_validasi){	
			// 		$pending[$day]=array(
			// 			"amount"=>$pending_query[$j]->amount,
			// 			"date"=>$date2,
			// 			"m_name"=>$pending_query[$j]->m_name
			// 			);
			// 		if($j<($maxpending-1)){$j++;}
			// 	}else{
			// 		$pending[$day]=array("amount"=>0,"date"=>$date1,"m_name"=>$pending_query[$j]->m_name);;	
			// 	}
			// }
			$day++;
			$date1 = date ("Y-m-d", strtotime("+1 day", strtotime($date1)));
		}
		// return array($sukses,$pending);
		return array($sukses);
	}

	public function dayByDaySalesBranch($awal,$akhir){
		$central_jakpusel =array();  // 5		
		$cirebon =array(); //6
		$bogor =array(); //8
		$karawang =array(); //9
		$banten =array(); //11
		$tasikmalaya =array(); //12
		$bandung =array(); //14
		$jakarta_barat =array(); //16
		$central_jakutim =array(); //18
		$soreang =array(); //19

		$central_jakpusel_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='5' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$cirebon_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='6' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$bogor_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='8' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$karawang_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='9' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$banten_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='11' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$tasikmalaya_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='12' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$bandung_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='14' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$jakarta_barat_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='16' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$central_jakutim_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='18' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		$soreang_query=$this->db->query("SELECT DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') as tanggal_aktif, count(psb_id) as amount, MONTHNAME('".$akhir."') as m_name FROM new_psb where
		status='sukses' AND branch_id='19' AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') between 
		'".$awal."' AND '".$akhir."' 
		GROUP BY tanggal_aktif")->result();

		//For central_jakpusel
		$maxcentral_jakpusel=count($central_jakpusel_query);
		$i=0;
		//For cirebon
		$maxcirebon=count($cirebon_query);
		$j=0;
		//For bogor
		$maxbogor=count($bogor_query);
		$k=0;
		//For karawang
		$maxkarawang=count($karawang_query);
		$l=0;
		//For banten
		$maxbanten=count($banten_query);
		$m=0;
		//For tasikmalaya
		$maxtasikmalaya=count($tasikmalaya_query);
		$n=0;
		//For bandung
		$maxbandung=count($bandung_query);
		$o=0;
		//For jakarta_barat
		$maxjakarta_barat=count($jakarta_barat_query);
		$p=0;
		//For central_jakutim
		$maxcentral_jakutim=count($central_jakutim_query);
		$q=0;
		//For soreang
		$maxsoreang=count($soreang_query);
		$r=0;

		$day=1;
		while (strtotime($awal) <= strtotime($akhir)) {
			//For central_jakpusel
			if($maxcentral_jakpusel>0){
				if($awal==$central_jakpusel_query[$i]->tanggal_aktif){	
					$central_jakpusel[$day]=array(
					"amount"=>$central_jakpusel_query[$i]->amount,
					"date"=>$awal,
					"m_name"=>$central_jakpusel_query[$i]->m_name
					);

					if($i<($maxcentral_jakpusel-1)){$i++;}
				}else{
					$central_jakpusel[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$central_jakpusel_query[$i]->m_name);;	
				}
			}
			//End central_jakpusel

			//For cirebon
			if($maxcirebon>0){
				if($awal==$cirebon_query[$j]->tanggal_aktif){	
					$cirebon[$day]=array(
						"amount"=>$cirebon_query[$j]->amount,
						"date"=>$awal,
						"m_name"=>$cirebon_query[$j]->m_name
						);
					if($j<($maxcirebon-1)){$j++;}
				}else{
					$cirebon[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$cirebon_query[$j]->m_name);;	
				}
			}
			//End cirebon

			//For bogor
			if($maxbogor>0){
				if($awal==$bogor_query[$k]->tanggal_aktif){	
					$bogor[$day]=array(
						"amount"=>$bogor_query[$k]->amount,
						"date"=>$awal,
						"m_name"=>$bogor_query[$k]->m_name
						);
					if($k<($maxbogor-1)){$k++;}
				}else{
					$bogor[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$bogor_query[$k]->m_name);;	
				}
			}
			//End bogor

			//For karawang
			if($maxkarawang>0){
				if($awal==$karawang_query[$l]->tanggal_aktif){	
					$karawang[$day]=array(
						"amount"=>$karawang_query[$l]->amount,
						"date"=>$awal,
						"m_name"=>$karawang_query[$l]->m_name
						);
					if($l<($maxkarawang-1)){$l++;}
				}else{
					$karawang[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$karawang_query[$l]->m_name);;	
				}
			}
			//End karawang

			//For banten
			if($maxbanten>0){
				if($awal==$banten_query[$m]->tanggal_aktif){	
					$banten[$day]=array(
						"amount"=>$banten_query[$m]->amount,
						"date"=>$awal,
						"m_name"=>$banten_query[$m]->m_name
						);
					if($m<($maxbanten-1)){$m++;}
				}else{
					$banten[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$banten_query[$m]->m_name);;	
				}
			}
			//End banten

			//For tasikmalaya
			if($maxtasikmalaya>0){
				if($awal==$tasikmalaya_query[$n]->tanggal_aktif){	
					$tasikmalaya[$day]=array(
						"amount"=>$tasikmalaya_query[$n]->amount,
						"date"=>$awal,
						"m_name"=>$tasikmalaya_query[$n]->m_name
						);
					if($n<($maxtasikmalaya-1)){$n++;}
				}else{
					$tasikmalaya[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$tasikmalaya_query[$n]->m_name);;	
				}
			}
			//End tasikmalaya

			//For bandung
			if($maxbandung>0){
				if($awal==$bandung_query[$o]->tanggal_aktif){	
					$bandung[$day]=array(
						"amount"=>$bandung_query[$o]->amount,
						"date"=>$awal,
						"m_name"=>$bandung_query[$o]->m_name
						);
					if($o<($maxbandung-1)){$o++;}
				}else{
					$bandung[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$bandung_query[$o]->m_name);;	
				}
			}
			//End bandung

			//For jakarta_barat
			if($maxjakarta_barat>0){
				if($awal==$jakarta_barat_query[$p]->tanggal_aktif){	
					$jakarta_barat[$day]=array(
						"amount"=>$jakarta_barat_query[$p]->amount,
						"date"=>$awal,
						"m_name"=>$jakarta_barat_query[$p]->m_name
						);
					if($p<($maxjakarta_barat-1)){$p++;}
				}else{
					$jakarta_barat[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$jakarta_barat_query[$p]->m_name);;	
				}
			}
			//End jakarta_barat

			//For central_jakutim
			if($maxcentral_jakutim>0){
				if($awal==$central_jakutim_query[$q]->tanggal_aktif){	
					$central_jakutim[$day]=array(
						"amount"=>$central_jakutim_query[$q]->amount,
						"date"=>$awal,
						"m_name"=>$central_jakutim_query[$q]->m_name
						);
					if($q<($maxcentral_jakutim-1)){$q++;}
				}else{
					$central_jakutim[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$central_jakutim_query[$q]->m_name);;	
				}
			}
			//End central_jakutim

			//For soreang
			if($maxsoreang>0){
				if($awal==$soreang_query[$r]->tanggal_aktif){	
					$soreang[$day]=array(
						"amount"=>$soreang_query[$r]->amount,
						"date"=>$awal,
						"m_name"=>$soreang_query[$r]->m_name
						);
					if($r<($maxsoreang-1)){$r++;}
				}else{
					$soreang[$day]=array("amount"=>0,"date"=>$awal,"m_name"=>$soreang_query[$r]->m_name);;	
				}
			}
			//End soreang

			$day++;
			$awal = date ("Y-m-d", strtotime("+1 day", strtotime($awal)));
		}
		// return array($sukses,$pending);
		return array($central_jakpusel, $cirebon, $bogor, $karawang, $banten, $tasikmalaya, $bandung, $jakarta_barat, $central_jakutim, $soreang);
	}

	//get top branch information 
	public function getTopBranch($limit=0, $ly='', $lm='', $tgl='')
	{
		$date = $tgl;
		// $last_date=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		// $date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		$sukses_query=$this->db->query("SELECT b.branch_id, b.nama_branch, 
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND branch_id=b.branch_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND branch_id=b.branch_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
			COUNT(a.psb_id) AS amount 
			FROM new_psb a 
			JOIN branch b ON a.branch_id=b.branch_id
			WHERE a.status='sukses' AND DATE_FORMAT(a.tanggal_aktif, '%Y-%m-%d') BETWEEN 
				ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$tgl."' GROUP BY b.nama_branch ORDER BY amount DESC LIMIT ".$limit."
			")->result();

		$result=$sukses_query;
		return $result;
	}

	//get top paket information 
	public function getTopPaket($limit=0, $ly='', $lm='', $tgl='')
	{
		$date = $tgl;
		// $last_date=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		// $date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		$paket_query=$this->db->query("SELECT b.paket_id, b.nama_paket, 
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND paket_id=b.paket_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND paket_id=b.paket_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
			count(a.psb_id) as amount 
			FROM new_psb a 
			JOIN paket b ON a.paket_id=b.paket_id
			WHERE a.status='sukses' AND DATE_FORMAT(a.tanggal_aktif, '%Y-%m-%d') between 
				ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND
				'".$tgl."' GROUP BY b.nama_paket order by amount desc limit ".$limit." ")->result();

		$result=$paket_query;
		return $result;

	}

	//get top TL information 
	public function getTopTL($limit=0, $ly='', $lm='', $tgl='')
	{
		$date = $tgl;
		// $last_date=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		// $date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		$tl_query=$this->db->query("SELECT b.id_users, b.username, b.nama, c.nama_branch, 
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND TL=b.username AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND TL=b.username AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
			count(a.psb_id) as amount 
			FROM new_psb a
			JOIN app_users b on a.TL=b.username
			JOIN branch c on a.branch_id=c.branch_id
			WHERE a.status='sukses' AND b.level='3' AND DATE_FORMAT(a.tanggal_aktif, '%Y-%m-%d') between 
				ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND
				'".$tgl."' GROUP BY b.nama order by amount desc limit ".$limit." ")->result();

		$result=$tl_query;
		return $result;

	}

	//get top channel information 
	public function getTopChannel($limit=0, $ly='', $lm='', $tgl='')
	{

		$channel_query=$this->db->query("SELECT a.sales_channel, 
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND sales_channel=a.sales_channel AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
			IFNULL((SELECT COUNT(psb_id) 
				FROM new_psb 
				WHERE STATUS='sukses' AND sales_channel=a.sales_channel AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
			count(a.psb_id) as amount 
			FROM new_psb a
			WHERE a.status='sukses' AND DATE_FORMAT(a.tanggal_aktif, '%Y-%m-%d') between 
				ADDDATE(LAST_DAY(SUBDATE('".$tgl."',INTERVAL 1 MONTH)), 1) AND
				'".$tgl."' GROUP BY a.sales_channel order by amount desc limit ".$limit." ")->result();

		$result=$channel_query;
		return $result;

	}

	//get report fee sales TSAinformation 
	public function getFeeSales($branch_id, $to_date)
	{
		$date = $to_date;
		// $lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));	
		if($branch_id=='17'){ //ALL
			$fee_query=$this->db->query("SELECT a.*, b.nama_branch, c.nama,
				IFNULL((SELECT COUNT(x.psb_id) 
					FROM new_psb x 
					LEFT JOIN paket y ON x.paket_id=y.paket_id 
					WHERE x.STATUS='sukses' AND x.sales_person=a.nama_sales AND y.id_kategori='2' AND DATE_FORMAT(x.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketkurang',
				IFNULL((SELECT COUNT(p.psb_id) 
					FROM new_psb p 
					LEFT JOIN paket q ON p.paket_id=q.paket_id 
					WHERE p.STATUS='sukses' AND p.sales_person=a.nama_sales AND q.id_kategori='1' AND DATE_FORMAT(p.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketlebih'
				FROM sales_person a
				LEFT JOIN branch b on b.branch_id=a.branch_id
				LEFT JOIN app_users c ON a.id_users=c.id_users
				WHERE a.status='Aktif'
				ORDER BY b.nama_branch, c.nama, a.nama_sales
				")->result();
		}else{
			$fee_query=$this->db->query("SELECT a.*, b.nama_branch, c.nama,
				IFNULL((SELECT COUNT(x.psb_id) 
					FROM new_psb x 
					LEFT JOIN paket y ON x.paket_id=y.paket_id 
					WHERE x.STATUS='sukses' AND x.sales_person=a.nama_sales AND y.id_kategori='2' AND DATE_FORMAT(x.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketkurang',
				IFNULL((SELECT COUNT(p.psb_id) 
					FROM new_psb p 
					LEFT JOIN paket q ON p.paket_id=q.paket_id 
					WHERE p.STATUS='sukses' AND p.sales_person=a.nama_sales AND q.id_kategori='1' AND DATE_FORMAT(p.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketlebih'
				FROM sales_person a
				LEFT JOIN branch b on b.branch_id=a.branch_id
				LEFT JOIN app_users c ON a.id_users=c.id_users
				WHERE a.status='Aktif' and b.branch_id='".$branch_id."'
				ORDER BY b.nama_branch, c.nama, a.nama_sales
				")->result();
		}
		$result=$fee_query;
		return $result;

	}

	//get report fee sales TL information 
	public function getFeeSalesTL($branch_id, $to_date)
	{
		$date = $to_date;
		// $lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));	
		if($branch_id=='17'){ //ALL
			$fee_query=$this->db->query("SELECT a.id_users, a.channel, a.nama, b.nama_branch,
				IFNULL((SELECT COUNT(x.psb_id) 
					FROM new_psb x 
					LEFT JOIN paket y ON x.paket_id=y.paket_id 
					WHERE x.STATUS='sukses' AND x.TL=a.username AND y.id_kategori='2' AND DATE_FORMAT(x.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketkurang',
				IFNULL((SELECT COUNT(p.psb_id) 
					FROM new_psb p 
					LEFT JOIN paket q ON p.paket_id=q.paket_id 
					WHERE p.STATUS='sukses' AND p.TL=a.username AND q.id_kategori='1' AND DATE_FORMAT(p.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketlebih'
				FROM app_users a
				LEFT JOIN branch b on b.branch_id=a.branch_id
				WHERE a.keterangan='Aktif' and a.level='3'
				ORDER BY b.nama_branch, a.channel, a.nama
				")->result();
		}else{
			$fee_query=$this->db->query("SELECT a.id_users, a.channel, a.nama, b.nama_branch,
				IFNULL((SELECT COUNT(x.psb_id) 
					FROM new_psb x 
					LEFT JOIN paket y ON x.paket_id=y.paket_id 
					WHERE x.STATUS='sukses' AND x.TL=a.username AND y.id_kategori='2' AND DATE_FORMAT(x.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketkurang',
				IFNULL((SELECT COUNT(p.psb_id) 
					FROM new_psb p 
					LEFT JOIN paket q ON p.paket_id=q.paket_id 
					WHERE p.STATUS='sukses' AND p.TL=a.username AND q.id_kategori='1' AND DATE_FORMAT(p.tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'jml_paketlebih'
				FROM app_users a
				LEFT JOIN branch b on b.branch_id=a.branch_id
				WHERE a.keterangan='Aktif' and a.level='3' AND b.branch_id='".$branch_id."'
				ORDER BY b.nama_branch, a.channel, a.nama
				")->result();
		}
		$result=$fee_query;
		return $result;

	}

	//get report branch information 
	public function getReportBranch($tanggal,$status,$ly,$to_date)
	{
		$date = $to_date;
		$lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));
		$branch_query=$this->db->query("SELECT b.branch_id, b.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
			IFNULL((SELECT COUNT(branch_id) 
				FROM new_psb 
				WHERE STATUS='".$status."' AND branch_id=b.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
			IFNULL((SELECT COUNT(branch_id) 
				FROM new_psb 
				WHERE STATUS='".$status."' AND branch_id=b.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
			IFNULL((SELECT COUNT(branch_id) 
				FROM new_psb 
				WHERE STATUS='".$status."' AND branch_id=b.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'this_month'
			FROM new_psb a 
			RIGHT JOIN branch b ON a.branch_id=b.branch_id
			WHERE b.branch_id not in('17')
			GROUP BY b.nama_branch ORDER BY this_month DESC
			")->result();

		$result=$branch_query;
		return $result;

	}

	//get report paket information 
	public function getReportPaket($branch_id,$tanggal,$status,$ly,$to_date)
	{
		$date = $to_date;
		$lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));
		if($branch_id=='17'){ //ALL
			$paket_query=$this->db->query("SELECT b.paket_id, b.nama_paket, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
				IFNULL((SELECT COUNT(paket_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND paket_id=b.paket_id AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
				IFNULL((SELECT COUNT(paket_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND paket_id=b.paket_id AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
				IFNULL((SELECT COUNT(paket_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND paket_id=b.paket_id AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'this_month'
				FROM new_psb a 
				right JOIN paket b ON a.paket_id=b.paket_id
				JOIN branch c ON c.branch_id=a.branch_id
				GROUP BY a.paket_id, c.branch_id order by this_month desc ")->result();
		}else{
			$paket_query=$this->db->query("SELECT b.paket_id, b.nama_paket, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
				IFNULL((SELECT COUNT(paket_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND paket_id=b.paket_id AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
				IFNULL((SELECT COUNT(paket_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND paket_id=b.paket_id AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
				IFNULL((SELECT COUNT(paket_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND paket_id=b.paket_id AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'this_month'
				FROM new_psb a 
				right JOIN paket b ON a.paket_id=b.paket_id
				JOIN branch c ON c.branch_id=a.branch_id
				WHERE c.branch_id='".$branch_id."' 
				GROUP BY a.paket_id, c.branch_id order by this_month desc ")->result();
		}
		

		$result=$paket_query;
		return $result;

	}

	//get report TL information 
	public function getReportTL($branch_id,$tanggal,$status,$ly,$to_date)
	{
		$date = $to_date;
		$lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));
		if($branch_id=='17'){ //ALL
			$tl_query=$this->db->query("SELECT b.id_users, b.username, b.nama, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla, 
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND TL=b.username AND branch_id = c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND TL=b.username AND branch_id = c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND TL=b.username AND branch_id = c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'this_month' 
				FROM new_psb a 
				right JOIN app_users b on a.TL=b.username
				JOIN branch c on a.branch_id=c.branch_id
				GROUP BY b.username, c.branch_id ORDER BY this_month DESC
				")->result();
		}else{
			$tl_query=$this->db->query("SELECT b.id_users, b.username, b.nama, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla, 
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND TL=b.username AND branch_id = c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND TL=b.username AND branch_id = c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND TL=b.username AND branch_id = c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'this_month'
				FROM new_psb a 
				right JOIN app_users b on a.TL=b.username
				JOIN branch c on a.branch_id=c.branch_id
				WHERE c.branch_id='".$branch_id."' 
				GROUP BY b.username, c.branch_id ORDER BY this_month DESC
				")->result();
		}
		$result=$tl_query;
		return $result;

	}

	//get report Sub Channel information 
	public function getReportSubChannel($branch_id,$tanggal,$status,$ly,$to_date)
	{
		$date = $to_date;
		$lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));
		if($branch_id=='17'){ //ALL
			$tl_query=$this->db->query("SELECT a.sales_channel, b.sub_channel, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND sub_sales_channel=a.sub_sales_channel AND sales_channel=a.sales_channel AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND sub_sales_channel=a.sub_sales_channel AND sales_channel=a.sales_channel AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND sub_sales_channel=a.sub_sales_channel AND sales_channel=a.sales_channel AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'last_month'
				FROM new_psb a 
				left JOIN sales_channel b on a.sub_sales_channel=b.id_channel
				JOIN branch c on a.branch_id=c.branch_id
				GROUP BY b.sub_channel, a.sales_channel, c.nama_branch ORDER BY this_month DESC
				")->result();
		}else{
			$tl_query=$this->db->query("SELECT a.sales_channel, b.sub_channel, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND sub_sales_channel=a.sub_sales_channel AND sales_channel=a.sales_channel AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$ly."',INTERVAL 1 MONTH)), 1) AND '".$ly."'),0) AS 'last_year',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND sub_sales_channel=a.sub_sales_channel AND sales_channel=a.sales_channel AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) AND '".$lm."'),0) AS 'last_month',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='".$status."' AND sub_sales_channel=a.sub_sales_channel AND sales_channel=a.sales_channel AND branch_id=c.branch_id AND DATE_FORMAT(".$tanggal.", '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'this_month'
				FROM new_psb a 
				left JOIN sales_channel b on a.sub_sales_channel=b.id_channel
				JOIN branch c on a.branch_id=c.branch_id
				WHERE c.branch_id='".$branch_id."' 
				GROUP BY b.sub_channel, a.sales_channel, c.nama_branch ORDER BY this_month DESC
				")->result();
		}

		$result=$tl_query;
		return $result;

	}

	//get report sales person information 
	public function getReportSalesPerson($branch_id,$tanggal,$status,$to_date)
	{
		$date = $to_date;
		$lm = date('Y-m-d', strtotime('-1 month', strtotime( $date )));
		if($branch_id=='17'){ //ALL
			$tl_query=$this->db->query("SELECT b.nama_sales, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
				count(a.psb_id) as this_month
				FROM new_psb a 
				right JOIN sales_person b on a.sales_person=b.nama_sales
				JOIN branch c on a.branch_id=c.branch_id
				WHERE a.status='".$status."' AND DATE_FORMAT(a.".$tanggal.", '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."' GROUP BY c.nama_branch, b.nama_sales ORDER BY this_month DESC
				")->result();
		}else{
			$tl_query=$this->db->query("SELECT b.nama_sales, c.nama_branch, SUM(DATEDIFF(a.".$tanggal.", a.tanggal_masuk)) as sla,
				count(a.psb_id) as this_month
				FROM new_psb a 
				right JOIN sales_person b on a.sales_person=b.nama_sales
				JOIN branch c on a.branch_id=c.branch_id
				WHERE c.branch_id='".$branch_id."' and a.status='".$status."' AND DATE_FORMAT(a.".$tanggal.", '%Y-%m-%d') BETWEEN 
					ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."' GROUP BY c.nama_branch, b.nama_sales ORDER BY this_month DESC
				")->result();
		}
		$result=$tl_query;
		return $result;

	}

	//get report status daily branch information 
	public function getStatusDaily($branch_id, $st, $tgl, $tahun, $bulan)
	{
		if($bulan<10){
			$bulan = '0'.$bulan;
		}else{
			$bulan = $bulan;
		}
		$status_query = $this->db->query("select 
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-01'),0) AS 'satu', 
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-02'),0) AS 'dua',
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-03'),0) AS 'tiga',
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-04'),0) AS 'empat',
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-05'),0) AS 'lima',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-06'),0) AS 'enam',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-07'),0) AS 'tujuh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-08'),0) AS 'delapan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-09'),0) AS 'sembilan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-10'),0) AS 'sepuluh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-11'),0) AS 'sebelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-12'),0) AS 'duabelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-13'),0) AS 'tigabelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-14'),0) AS 'empatbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-15'),0) AS 'limabelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-16'),0) AS 'enambelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-17'),0) AS 'tujuhbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-18'),0) AS 'delapanbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-19'),0) AS 'sembilanbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-20'),0) AS 'duapuluh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-21'),0) AS 'duasatu',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-22'),0) AS 'duadua',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-23'),0) AS 'duatiga',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-24'),0) AS 'duaempat',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-25'),0) AS 'dualima',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-26'),0) AS 'duaenam',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-27'),0) AS 'duatujuh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-28'),0) AS 'duadelapan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-29'),0) AS 'duasembilan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-30'),0) AS 'tigapuluh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND branch_id=a.branch_id AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-31'),0) AS 'tigasatu'    
                from branch a
                where branch_id='".$branch_id."'
            ")->row();
		$result=$status_query;
		return $result;

	}

	//get report status daily branch information 
	public function getStatusDailyAll($st, $tgl, $tahun, $bulan)
	{
		if($bulan<10){
			$bulan = '0'.$bulan;
		}else{
			$bulan = $bulan;
		}
		$status_query = $this->db->query("select 
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-01'),0) AS 'satu', 
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-02'),0) AS 'dua',
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-03'),0) AS 'tiga',
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-04'),0) AS 'empat',
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-05'),0) AS 'lima',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-06'),0) AS 'enam',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-07'),0) AS 'tujuh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-08'),0) AS 'delapan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-09'),0) AS 'sembilan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-10'),0) AS 'sepuluh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-11'),0) AS 'sebelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-12'),0) AS 'duabelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-13'),0) AS 'tigabelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-14'),0) AS 'empatbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-15'),0) AS 'limabelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-16'),0) AS 'enambelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-17'),0) AS 'tujuhbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-18'),0) AS 'delapanbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-19'),0) AS 'sembilanbelas',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-20'),0) AS 'duapuluh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-21'),0) AS 'duasatu',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-22'),0) AS 'duadua',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-23'),0) AS 'duatiga',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-24'),0) AS 'duaempat',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-25'),0) AS 'dualima',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-26'),0) AS 'duaenam',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-27'),0) AS 'duatujuh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-28'),0) AS 'duadelapan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-29'),0) AS 'duasembilan',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-30'),0) AS 'tigapuluh',    
			IFNULL((SELECT COUNT(psb_id) FROM new_psb WHERE STATUS='".$st."' AND DATE_FORMAT($tgl,'%Y-%m-%d')='".$tahun."-".$bulan."-31'),0) AS 'tigasatu'    
                from branch limit 1
            ")->row();
		$result=$status_query;
		return $result;

	}

	public function getContrStatus($tgl = ''){
		$date=$tgl;		
		$sukses=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='sukses' AND DATE_FORMAT(tanggal_aktif,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$reject=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='reject' AND DATE_FORMAT(tanggal_validasi,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$retur=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='retur' AND DATE_FORMAT(tanggal_validasi,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$pending=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='pending' AND DATE_FORMAT(tanggal_validasi,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$cancel=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='cancel' AND DATE_FORMAT(tanggal_validasi,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$bentrok=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='bentrok' AND DATE_FORMAT(tanggal_aktif,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$masuk=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='masuk' AND DATE_FORMAT(tanggal_masuk,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$blacklist=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='blacklist' AND DATE_FORMAT(tanggal_aktif,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		$valid=$this->db->query("SELECT count(psb_id) as amount 
			FROM new_psb
			WHERE status='valid' AND DATE_FORMAT(tanggal_aktif,'%Y-%m-%d') between 
			ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'")->row();

		return array(
			"sukses"=>$sukses->amount,
			"reject"=>$reject->amount,
			"retur"=>$retur->amount,
			"pending"=>$pending->amount,
			"cancel"=>$cancel->amount,
			"bentrok"=>$bentrok->amount,
			"masuk"=>$masuk->amount,
			"blacklist"=>$blacklist->amount,
			"valid"=>$valid->amount,
		);

	}

	//get top branch information 
	public function getStatusBranch($opsi='', $tgl='')
	{
		$date = $tgl;
		// $last_date=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$lm."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		// $date1=$this->db->query("SELECT ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) as d")->row()->d;
		if($opsi == "opsi1"){
			$sukses_query=$this->db->query("SELECT a.branch_id, a.nama_branch, 
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='sukses' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'sukses',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='valid' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'valid',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='cancel' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'cancel',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='reject' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'reject',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='pending' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'pending',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='retur' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'retur',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='bentrok' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'bentrok',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='blacklist' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'blacklist',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='masuk' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'masuk'
				FROM branch a 
				where branch_id not in('17')
				ORDER BY sukses desc")->result();
		}else if($opsi == "opsi2"){
			$sukses_query=$this->db->query("SELECT a.branch_id, a.nama_branch, 
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='sukses' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'sukses',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='sukses' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'sukses_masuk',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='valid' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'valid',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='cancel' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'cancel',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='reject' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'reject',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='pending' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'pending',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='retur' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'retur',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='bentrok' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'bentrok',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='blacklist' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'blacklist',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='masuk' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'masuk'
				FROM branch a 
				where branch_id not in('17')
				ORDER BY sukses desc")->result();
		}else{
			$sukses_query=$this->db->query("SELECT a.branch_id, a.nama_branch, 
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='sukses' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'sukses',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='valid' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'valid',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='cancel' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'cancel',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='reject' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'reject',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='pending' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'pending',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='retur' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_validasi, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'retur',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='bentrok' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'bentrok',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='blacklist' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_aktif, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'blacklist',
				IFNULL((SELECT COUNT(psb_id) 
					FROM new_psb 
					WHERE STATUS='masuk' AND branch_id=a.branch_id AND DATE_FORMAT(tanggal_masuk, '%Y-%m-%d') BETWEEN 
						ADDDATE(LAST_DAY(SUBDATE('".$date."',INTERVAL 1 MONTH)), 1) AND '".$date."'),0) AS 'masuk'
				FROM branch a 
				where branch_id not in('17')
				ORDER BY sukses desc")->result();
		}

		$result=$sukses_query;
		return $result;
	}

}